<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EthOS Blaster: Ultimate Edition</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Fredoka One', cursive;
      background: linear-gradient(180deg, #a8edea 0%, #fed6e3 100%);
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 2rem;
      color: #2d3748;
      user-select: none;
      overflow: hidden;
    }
    #gameCanvas {
      border-radius: 1rem;
      box-shadow: 0 0 0 8px #fcd34d, 0 0 20px 10px #fbbf24, 0 0 40px 15px #f59e0b;
      max-width: 100%;
      height: auto;
      background: #fef3c7;
      display: block;
      margin: 0 auto;
      border: 5px solid #fbbf24;
      image-rendering: pixelated;
      filter: drop-shadow(0 6px 4px rgba(0,0,0,0.2));
    }
    button:focus {
      outline: none;
      box-shadow: 0 0 15px 5px #fbbf24;
    }
    header {
      width: 100%;
      max-width: 6xl;
      margin-bottom: 2rem;
      padding: 0 1.5rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 1.5rem;
    }
    header h1 {
      font-family: 'Press Start 2P', cursive;
      font-size: 2.5rem;
      color: #f59e0b;
      text-shadow: 3px 3px 0 #b45309, 5px 5px 0 #78350f;
      flex-grow: 1;
      max-width: 100%;
    }
    nav {
      display: flex;
      gap: 1.5rem;
      flex-wrap: nowrap;
      flex-shrink: 0;
    }
    .btn-pokemon {
      font-family: 'Fredoka One', cursive;
      background: linear-gradient(145deg, #fbbf24, #f59e0b);
      border: 4px solid #b45309;
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      font-weight: 700;
      font-size: 1rem;
      color: #fff;
      text-shadow: 1px 1px 2px #78350f;
      box-shadow: inset 0 4px 0 #fcd34d, 0 6px 0 #78350f;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.2s ease-in-out;
      white-space: nowrap;
    }
    .btn-pokemon i {
      font-size: 1.2rem;
      filter: drop-shadow(1px 1px 1px #78350f);
    }
    .btn-pokemon:hover {
      background: linear-gradient(145deg, #f59e0b, #fbbf24);
      box-shadow: inset 0 4px 0 #fcd34d, 0 8px 0 #78350f;
      transform: translateY(-3px);
    }
    .btn-pokemon:active {
      box-shadow: inset 0 4px 0 #78350f;
      transform: translateY(2px);
    }
    #ui {
      background: #fef3c7;
      border: 5px solid #fbbf24;
      border-radius: 1.5rem;
      padding: 1.5rem 2.5rem;
      box-shadow: 0 0 15px #fbbf24aa, inset 0 0 10px #fcd34dcc;
      max-width: 900px;
      margin: 2rem auto 0;
      display: flex;
      justify-content: space-between;
      gap: 2rem;
      font-weight: 700;
      font-size: 1.2rem;
      color: #b45309;
      text-shadow: 1px 1px 0 #fcd34d;
      flex-wrap: nowrap;
      align-items: center;
    }
    #ui > div {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
      white-space: nowrap;
    }
    .bar {
      width: 200px;
      height: 20px;
      background: #e5e7eb;
      border: 2px solid #b45309;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    }
    .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #f59e0b, #fbbf24);
      transition: width 0.3s ease;
    }
    #health .bar-fill {
      background: linear-gradient(90deg, #dc2626, #f87171);
    }
    #ui i {
      color: #f59e0b;
      font-size: 1.8rem;
      filter: drop-shadow(1px 1px 1px #78350f);
    }
    #gameOverBox {
      background: #fef3c7;
      border: 6px solid #b45309;
      box-shadow: 0 0 25px #fbbf24, inset 0 0 20px #fcd34d;
      border-radius: 2rem;
      padding: 2.5rem 3.5rem;
      max-width: 500px;
      color: #b45309;
      text-shadow: 1px 1px 0 #78350f;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 20;
      animation: fadeIn 0.5s ease-in;
    }
    #gameOverBox h2 {
      font-family: 'Press Start 2P', cursive;
      font-size: 2.8rem;
      margin-bottom: 1.5rem;
      color: #dc2626;
      text-shadow: 3px 3px 0 #7f1d1d, 5px 5px 0 #b91c1c;
    }
    #gameOverBox p {
      font-size: 1.2rem;
      margin-bottom: 2rem;
      color: #92400e;
      font-weight: 700;
    }
    #gameOverBox i {
      font-size: 6rem;
      color: #dc2626;
      filter: drop-shadow(0 0 10px #dc2626);
      margin-bottom: 1.5rem;
      animation: pulseRed 1.5s infinite alternate;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }
    @keyframes pulseRed {
      0% { filter: drop-shadow(0 0 10px #dc2626); }
      100% { filter: drop-shadow(0 0 25px #b91c1c); }
    }
    kbd {
      background-color: #fbbf24;
      color: #78350f;
      border-radius: 0.5rem;
      padding: 0.3rem 0.8rem;
      font-weight: 900;
      font-size: 0.9rem;
      font-family: 'Press Start 2P', cursive;
      box-shadow: inset 0 -2px 0 #b45309, 0 2px 4px rgb(0 0 0 / 0.15);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    footer {
      color: #b45309;
      font-weight: 700;
      margin-top: 3rem;
      font-family: 'Fredoka One', cursive;
      text-shadow: 1px 1px 0 #fcd34d;
      font-size: 1rem;
    }
    .particle {
      position: absolute;
      pointer-events: none;
      background: #fbbf24;
      border-radius: 50%;
      box-shadow: 0 0 10px #f59e0b;
      animation: particleFade 1s ease-out forwards;
    }
    @keyframes particleFade {
      0% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(0.2); }
    }
    @media (max-width: 768px) {
      #ui {
        flex-direction: column;
        gap: 1.5rem;
        font-size: 1.1rem;
        padding: 1.5rem;
        align-items: flex-start;
      }
      .bar {
        width: 150px;
      }
      header h1 {
        font-size: 2rem;
      }
      nav {
        gap: 1rem;
      }
      .btn-pokemon {
        padding: 0.6rem 1.2rem;
        font-size: 0.9rem;
      }
      #gameOverBox {
        padding: 2rem 2.5rem;
        max-width: 90vw;
      }
    }
    @media (max-width: 480px) {
      #gameCanvas {
        width: 100%;
        height: auto;
      }
      header h1 {
        font-size: 1.5rem;
      }
      .btn-pokemon {
        padding: 0.5rem 1rem;
        font-size: 0.85rem;
      }
      #ui {
        font-size: 1rem;
        padding: 1rem;
      }
      .bar {
        width: 120px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>EthOS Blaster: Ultimate Edition</h1>
    <nav id="controls" aria-label="Game controls">
      <button id="btnJump" aria-label="Jump (Space)" class="btn-pokemon" type="button">
        <i class="fas fa-parachute-box"></i> Jump (Space)
      </button>
      <button id="btnShoot" aria-label="Shoot (Enter)" class="btn-pokemon" type="button">
        <i class="fas fa-crosshairs"></i> Shoot (Enter)
      </button>
    </nav>
  </header>

  <section class="w-full max-w-6xl rounded-xl p-6 relative" style="background: #fef3c7; box-shadow: inset 0 0 40px #fbbf24aa;">
    <canvas id="gameCanvas" width="900" height="450" role="img" aria-label="EthOS Blaster game canvas showing player, enemies, bombs, bullets, and background"></canvas>
    <div id="threeCanvas" style="position: absolute; top: 0; left: 0; pointer-events: none;"></div>

    <div id="ui" aria-live="polite" aria-atomic="true" class="mt-8" role="region" aria-label="Game status">
      <div id="score">
        <div class="flex items-center gap-3">
          <i class="fas fa-star"></i> Score: <span id="scoreValue">0</span>
        </div>
        <div class="bar">
          <div id="scoreBar" class="bar-fill" style="width: 0%;"></div>
        </div>
      </div>
      <div id="health">
        <div class="flex items-center gap-3">
          <i class="fas fa-heart"></i> Health
        </div>
        <div class="bar">
          <div id="healthBar" class="bar-fill" style="width: 100%;"></div>
        </div>
      </div>
      <div id="level" class="flex items-center gap-3">
        <i class="fas fa-layer-group"></i> Level: <span id="levelValue">1</span>
      </div>
    </div>

    <div id="gameOverBox" role="alert" aria-live="assertive">
      <i class="fas fa-skull-crossbones"></i>
      <h2>Game Over!</h2>
      <p>Your Score: <span id="finalScore">0</span><br>Press <kbd>R</kbd> or click below to restart.</p>
      <button id="restartBtn" class="btn-pokemon px-10 py-4 text-lg" type="button">
        Restart Game
      </button>
    </div>
  </section>

  <footer>
    &copy; 2025 EthOS Blaster &mdash; Developed by Sreyanshu &amp; ❤️
  </footer>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const threeCanvas = document.getElementById('threeCanvas');

    // Three.js setup for particle effects
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: threeCanvas, alpha: true });
    renderer.setSize(canvas.width, canvas.height);
    camera.position.z = 5;

    // Sound effects
    const shootSound = new Audio('https://raw.githubusercontent.com/singlakrishna243-oss/Song/main/gun-shot-350315_wtD7wvg5.mp3');
    const hitSound = new Audio('https://media1.vocaroo.com/mp3/19sLasLVoq87');
    const gameOverSound = new Audio('https://audio-previews.elements.envatousercontent.com/files/316721707/preview.mp3');
    const bombSound = new Audio('https://audio-previews.elements.envatousercontent.com/files/123456789/preview.mp3'); // Placeholder for bomb sound

    // Load images
    const ethImg = new Image();
    ethImg.src = 'https://placehold.co/80x80/png?text=ETH+Player&font=Fredoka+One&fontSize=18&bg=fff3c7&txtclr=f59e0b';
    ethImg.alt = "Pixel art style Ethereum logo character in orange and yellow tones, standing ready to jump or shoot";

    const btcImg = new Image();
    btcImg.src = 'https://placehold.co/80x80/png?text=BTC+Enemy&font=Fredoka+One&fontSize=18&bg=fff3c7&txtclr=f59e0b';
    btcImg.alt = "Pixel art style Bitcoin logo character in orange and yellow tones, cartoon mascot style, moving left";

    const bombImg = new Image();
    bombImg.src = 'https://placehold.co/60x60/png?text=💣&font=Fredoka+One&fontSize=40&bg=fff3c7&txtclr=dc2626';
    bombImg.alt = "Pixel art style bomb with a red and black color scheme, moving left";

    const backgroundImg = new Image();
    backgroundImg.src = './20250804_123803.jpg';
    backgroundImg.alt = "Pixel art style desert background with sandy ground and clear sky in warm pastel colors";

    // Apply blur to background
    ctx.filter = 'blur(2px)';
    backgroundImg.onload = () => {
      ctx.filter = 'none'; // Reset filter after background
    };

    const player = {
      x: 50,
      y: 350,
      width: 80,
      height: 80,
      vy: 0,
      gravity: 1.5,
      jumpStrength: -20,
      grounded: true,
      health: 100, // Percentage-based for health bar
      maxHealth: 100
    };

    const bullets = [];
    const enemies = [];
    const particles = [];
    let score = 0;
    let level = 1;
    let gameOver = false;

    const scoreEl = document.getElementById('scoreValue');
    const healthEl = document.getElementById('healthBar');
    const levelEl = document.getElementById('levelValue');
    const scoreBar = document.getElementById('scoreBar');
    const gameOverBox = document.getElementById('gameOverBox');
    const finalScoreEl = document.getElementById('finalScore');
    const restartBtn = document.getElementById('restartBtn');
    const btnJump = document.getElementById('btnJump');
    const btnShoot = document.getElementById('btnShoot');

    // Level thresholds and enemy speeds
    const levelThresholds = [0, 10, 25, 45, 70, 100, 135, 175, 220, 270, 330];
    const maxLevel = levelThresholds.length;

    function getLevel(score) {
      for (let i = maxLevel - 1; i >= 0; i--) {
        if (score >= levelThresholds[i]) return i + 1;
      }
      return 1;
    }

    function getScoreProgress(score, level) {
      if (level === maxLevel) return 100;
      const currentThreshold = levelThresholds[level - 1];
      const nextThreshold = levelThresholds[level] || levelThresholds[maxLevel - 1];
      return ((score - currentThreshold) / (nextThreshold - currentThreshold)) * 100;
    }

    function getEnemySpeed(level) {
      return Math.min(3 + (level - 1) * 0.7, 12);
    }

    function drawPlayer() {
      ctx.save();
      ctx.imageSmoothingEnabled = false;
      ctx.filter = 'drop-shadow(0 0 10px #fbbf24)';
      ctx.drawImage(ethImg, player.x, player.y, player.width, player.height);
      ctx.restore();
    }

    function drawBullet(bullet) {
      ctx.save();
      ctx.fillStyle = '#fbbf24';
      ctx.shadowColor = '#b45309';
      ctx.shadowBlur = 15;
      ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
      ctx.restore();
    }

    function drawEnemy(enemy) {
      ctx.save();
      ctx.imageSmoothingEnabled = false;
      ctx.filter = 'drop-shadow(0 0 8px #dc2626)';
      ctx.drawImage(enemy.logo, enemy.x, enemy.y, enemy.width, enemy.height);
      ctx.restore();
    }

    function createParticles(x, y, count = 10) {
      for (let i = 0; i < count; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = `${x}px`;
        particle.style.top = `${y}px`;
        particle.style.width = `${Math.random() * 10 + 5}px`;
        particle.style.height = particle.style.width;
        particle.style.transform = `translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px)`;
        document.body.appendChild(particle);
        setTimeout(() => particle.remove(), 1000);
      }
    }

    function jump() {
      if (gameOver) return;
      if (player.grounded) {
        player.vy = player.jumpStrength;
        player.grounded = false;
        createParticles(player.x + player.width / 2, player.y + player.height, 5);
      }
    }

    function shoot() {
      if (gameOver) return;
      shootSound.currentTime = 0;
      shootSound.play();
      bullets.push({
        x: player.x + player.width,
        y: player.y + player.height / 2 - 5,
        width: 15,
        height: 5,
        speed: 12
      });
      createParticles(player.x + player.width, player.y + player.height / 2, 3);
    }

    function spawnEnemy() {
      if (gameOver) return;
      const isBomb = Math.random() < 0.3; // 30% chance for bomb
      enemies.push({
        x: canvas.width,
        y: 350,
        width: isBomb ? 60 : 80,
        height: isBomb ? 60 : 80,
        speed: getEnemySpeed(level) * (isBomb ? 1.2 : 1),
        logo: isBomb ? bombImg : btcImg,
        isBomb
      });
    }

    function resetGame() {
      score = 0;
      level = 1;
      player.health = player.maxHealth;
      player.y = 350;
      player.vy = 0;
      player.grounded = true;
      bullets.length = 0;
      enemies.length = 0;
      gameOver = false;
      scoreEl.textContent = '0';
      healthEl.style.width = '100%';
      levelEl.textContent = '1';
      scoreBar.style.width = '0%';
      gameOverBox.style.display = 'none';
      ctx.filter = 'blur(2px)';
      backgroundImg.onload = () => {
        ctx.filter = 'none';
      };
      update();
    }

    function update() {
      if (gameOver) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw background with blur
      ctx.save();
      ctx.filter = 'blur(2px)';
      ctx.imageSmoothingEnabled = false;
      ctx.drawImage(backgroundImg, 0, 0, canvas.width, canvas.height);
      ctx.restore();

      // Ground
      ctx.save();
      ctx.fillStyle = '#f4a261';
      ctx.shadowColor = '#b45309';
      ctx.shadowBlur = 10;
      ctx.fillRect(0, 400, canvas.width, 50);
      ctx.restore();

      // Player physics
      player.vy += player.gravity;
      player.y += player.vy;
      if (player.y + player.height >= 400) {
        player.y = 400 - player.height;
        player.vy = 0;
        player.grounded = true;
      }
      drawPlayer();

      // Bullets
      for (let i = bullets.length - 1; i >= 0; i--) {
        bullets[i].x += bullets[i].speed;
        drawBullet(bullets[i]);
        if (bullets[i].x > canvas.width) {
          bullets.splice(i, 1);
        }
      }

      // Enemies
      for (let i = enemies.length - 1; i >= 0; i--) {
        const enemy = enemies[i];
        enemy.x -= enemy.speed;
        drawEnemy(enemy);

        // Player collision
        if (
          player.x < enemy.x + enemy.width &&
          player.x + player.width > enemy.x &&
          player.y < enemy.y + enemy.height &&
          player.y + player.height > enemy.y
        ) {
          enemies.splice(i, 1);
          player.health = Math.max(0, player.health - (enemy.isBomb ? 50 : 20));
          healthEl.style.width = `${player.health}%`;
          createParticles(player.x + player.width / 2, player.y + player.height / 2, 15);
          if (player.health <= 0) {
            gameOverSound.play();
            gameOver = true;
            finalScoreEl.textContent = score;
            gameOverBox.style.display = 'flex';
          }
          continue;
        }

        // Bullet collision
        for (let j = bullets.length - 1; j >= 0; j--) {
          const bullet = bullets[j];
          if (
            bullet.x < enemy.x + enemy.width &&
            bullet.x + bullet.width > enemy.x &&
            bullet.y < enemy.y + enemy.height &&
            bullet.y + bullet.height > enemy.y
          ) {
            bullets.splice(j, 1);
            enemies.splice(i, 1);
            createParticles(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2, 10);
            if (enemy.isBomb) {
              bombSound.play();
              player.health = Math.max(0, player.health - 30);
              healthEl.style.width = `${player.health}%`;
              if (player.health <= 0) {
                gameOverSound.play();
                gameOver = true;
                finalScoreEl.textContent = score;
                gameOverBox.style.display = 'flex';
              }
            } else {
              hitSound.currentTime = 0;
              hitSound.play();
              score++;
              scoreEl.textContent = score;
              scoreBar.style.width = `${getScoreProgress(score, level)}%`;
              const newLevel = getLevel(score);
              if (newLevel !== level) {
                level = newLevel;
                levelEl.textContent = level;
              }
            }
            break;
          }
        }

        if (enemy.x + enemy.width < 0) {
          enemies.splice(i, 1);
        }
      }

      renderer.render(scene, camera);
      requestAnimationFrame(update);
    }

    document.addEventListener('keydown', (e) => {
      if (gameOver && e.code !== 'KeyR') return;
      if (e.code === 'Space') {
        e.preventDefault();
        jump();
      } else if (e.code === 'Enter') {
        e.preventDefault();
        shoot();
      } else if (e.code === 'KeyR' && gameOver) {
        resetGame();
      }
    });

    btnJump.addEventListener('click', jump);
    btnShoot.addEventListener('click', shoot);
    restartBtn.addEventListener('click', resetGame);

    let imagesLoaded = 0;
    const images = [ethImg, btcImg, bombImg, backgroundImg];
    images.forEach((img) => {
      img.onload = () => {
        imagesLoaded++;
        if (imagesLoaded === images.length) {
          update();
          setInterval(spawnEnemy, 1500); // Faster spawn for dynamic gameplay
        }
      };
      img.onerror = () => {
        imagesLoaded++;
        if (imagesLoaded === images.length) {
          update();
          setInterval(spawnEnemy, 1500);
        }
      };
    });
  </script>
</body>
</html>
